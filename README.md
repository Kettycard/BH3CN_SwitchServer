# 「崩坏3」跨服手册（iOS 端 → 安卓国服）
 > By: [Mornwind](https://blog.mornwind.cc)
 > 
 > GitHub Link: [Mornwind/BH3CN_SwitchServer](https://github.com/Mornwind/BH3CN_SwitchServer)

## 致谢
- **参考&协助**
  - [霞ヶ丘詩羽x](https://space.bilibili.com/455501)：[B站专栏（cv3610324）](https://www.bilibili.com/read/cv3610324)
  - [FlintyLemming](https://space.bilibili.com/6876517)：[QuanX 跨服教程](https://bitbucket.flinty.moe/projects/PER/repos/bh3_server_switch/browse)
- **指导&纠错**
  - NobyDa
  - chavyleung
  - KorenKrita

## 前言
作为一个晚登录两三天没能拿到“登录纪念勋章”的安卓国服的甲板老清洁工，自从嫌弃安卓机的卡慢（以及当年月光的光翼特效显示不出来），咬咬牙入了 iPod touch 和 iPad Pro 之后，便开始发愁：安卓端甲板上的老婆们，要怎么打包带到 iOS 端？

奈何，米忽悠一直不为 iOS 客户端加上安卓国服的登录入口（反过来也没有）。后来 ME 社跨服包的出现，为我带来了一线光明。找“Msk包子”大佬购入了无需自签的 iOS 端跨服客户端以后，连续用了好几个版本，省去了每周重新自签的麻烦，倒也还算舒服（只不过得每隔三四个版本付一次分发平台的证书费）。

最近在 TG 上研究 Surge 4 上可用的签到脚本的时候，偶然结识了一位在用 Quantumult X 的大佬“FlintyLemming”，而他的为崩坏3跨服的方法为我指明了另一条道路，也就促使了本项目的诞生。

在跟“FlintyLemming”大佬进行沟通交流的过程中，我也了解到，他在 Quantumult X 上实现的跨服方法，是借鉴B站一位大佬“霞ヶ丘詩羽x”提供的方案而完成的。而本项目，则是同时借鉴了两位大佬的方法，在 Surge 4 上实现了跨服，同时也为 Quantumult X 用户提供了另一种自定义方案。

此项目的初衷，就是为了能让常挂代理工具（如：Surge 4、Quantumult X）的玩家，无需频繁开关代理工具，就能在忘掉有这么一回事的情况下，在 iOS 端直接登入安卓国服，上舰<del>玩老婆</del>陪老婆玩。

---

## ⚠️ 注意事项 ⚠️
1. **非官方直接提供的“跨服”行为，本身就违反了 Mihoyo 的用户协议。如若担心自己被封号，请勿使用本方法跨服，买对应的设备去玩更安全放心。**
2. 目前在 iOS 端登录安卓国服，仍无法进行充值，还需要自备安卓设备或者用 PC 端进行充值。
3. 本项目内所提到的所有客户端与服务器，均为**国服**。
4. 目前跨服**只可在官服之间进行**。渠道服由于**账号系统**不同以及游戏包体中的**登录器**不同，现阶段没有找到方法跨服，只能通过在 PC 端上扫码进行登录这种方式，敬请见谅。本项目中关于渠道服的部分，仅作学习参考，尚起不到实际用途。
5. **若出现资源缺失，需先进 iOS 国服下载资源。**

---

## 效果预览
![崩坏3 跨服预览](/BH3CN_SwitchServer_Preview.jpg)

---

## iOS 端常见跨服方式
在 iOS 端上，常见的游戏跨服方式主要可分为以下三大类六小类：

| 类型 | 方式 | 优点 | 缺点 |
| :-: | :-: | :-: | :-: |
| [A-1](#a-1-类型已全部失效) | 通过**使用网络调试工具**，<br/>**在本地重写客户端请求**，<br/>**直接**实现跨服 | 本地修改无需依赖他人<br/>基本不受游戏版本更新影响 | 需要会亿点操作<br/>部分工具价格较高<br/>部分工具在国区无法下载 |
| [A-2](#a-2-类型未提供) | 通过**使用他人提供的代理服务器**，<br/>**在远端重写客户端请求**，<br/>**直接**实现跨服 | 操作较少 | 依赖代理服务器的稳定性<br/>安全性无法保证 |
| [B-1](#b-类型已全部失效) | 通过**对游戏客户端修改后重新打包**，<br/>**由他人统一签名后在线下载安装**，<br/>**直接**实现跨服 | 几乎无需操作 | 签名所需证书费较贵<br/>更新后需等待新跨服包发布 |
| [B-2](#b-类型已全部失效) | 通过**对游戏客户端修改后重新打包**，<br/>**自行签名然后越狱安装或侧载**，<br/>**直接**实现跨服 | 无需花钱 | 需要会亿点操作<br/>越狱影响系统安全性<br/>每 7 天需重新签名<br/>更新后需等待新跨服包发布 |
| [C-1](#c-1-类型) | 通过**使用云游戏平台**，<br/>**将游戏画面实时传输至移动设备**，<br/>**间接**实现跨服 | 操作较少<br/>能跨部分渠道服 | 可选渠道服受制于云平台<br/>严重依赖网络质量<br/>安全性无法保证<br/>非会员每日游戏时长受限<br/>非会员每次进入需排队等候 |
| [C-2](#c-2-类型) | 通过**使用云主机**，<br/>**将游戏画面实时传输至移动设备**，<br/>**间接**实现跨服 | 能跨渠道服 | 需要会亿点操作<br/>云主机普遍价格很高<br/>严重依赖网络质量 |

## A-1 类型（已全部失效）
 > A-1：通过**使用网络调试工具**，**在本地重写客户端请求**，**直接**实现跨服。

| 图标 | 跨服工具 | 别名 | 跨服教程与配置 |
| :-: | :-: | :-: | :-: |
| ![](/HTTP_Catcher/HTTP_Catcher_Icon.png) | HTTP Catcher | 网球 | [文字教程](#-http-catcher) |
| ![](/iHTTP_Tracker/iHTTP_Tracker_Icon.png) | iHTTP Tracker | 猫头鹰 | [文字教程](#-ihttp-tracker) |
| ![](/Thor/Thor_Icon.png) | Thor | 锤子 | [文字教程](#-thor) |
| ![](/Shadowrocket/Shadowrocket_Icon.png) | Shadowrocket | 小火箭 | [文字教程](#-shadowrocket) |
| ![](/Pepi/Pepi_Icon.png) | Pepi | - | [文字教程](#-pepi) |
| ![](/Quantumult/Quantumult_Icon.png) | Quantumult | 圈 | [文字教程](#-quantumult) |
| ![](/Quantumult_X/Quantumult_X_Icon.png) | Quantumult X | 圈叉 | [图文教程（Flinty）](https://bitbucket.flinty.moe/projects/PER/repos/bh3_server_switch/browse/README.md)<br/>[文字教程](#-quantumult-x) |
| ![](/Surge_4/Surge_4_Icon.png) | Surge 4 | - | [文字教程](#-surge-4) |
| ![](/Loon/Loon_Icon.png) | Loon | 气球 | 参考 Surge 4 |

| 跨服工具 | 国区商店<br/>购买与下载 | 正规渠道价格 | 跨服操作<br/>方便程度 | 设备上同时<br/>挂梯与跨服 | 备注 |
| :-: | :-: | :-: | :-: | :-: | :-: |
| HTTP Catcher<br/>（网球） | ✅ | ¥28.00（内购）<br/>\$3.99（内购） | ★★★★ | ❌ | 3.0 版正在开发中 |
| iHTTP Tracker<br/>（猫头鹰） | ✅ | ¥18.00<br/>\$2.99 | ★★★★ | ❌ | 需 2.0 版 |
| Thor<br/>（锤子） | ✅ | ¥88.00<br/>\$12.99 | ★★★★ | ❌ |  |
| Shadowrocket<br/>（小火箭） | ❌ | \$2.99 | ★★★ | ✅ |  |
| Pepi | ❌ | \$1.99 | ★★ | ✅ | 开发者已停更 |
| Quantumult<br/>（圈） | ❌ | \$4.99 | ★★ | ✅ | 开发者已停更 |
| Quantumult X<br/>（圈叉） | ❌ | \$7.99 | ★★ | ✅ | TF 名额已满 |
| Surge 4 | ❌ | \$49.99（首次内购）<br/>+ \$14.99/y（订阅） | ★★ | ✅ |  |
| Loon<br/>（气球） | ❌ | \$2.99 | ★★ | ✅ | Bug 较多 |

 > 注：
 > 
 > 世界蛇⟡崩3少前跨服 - QQ 群：[`915089623`](https://jq.qq.com/?_wv=1027&k=5rnvPAT)

### ⑴ HTTP Catcher

<details>
<summary>点击查看：配置方法（已失效）</summary>

#### ⚠️ 特别说明 ⚠️
1. 需定时清理抓包记录，避免长时间使用后，占用太多存储空间。

#### 配置方法
1. **下载并导入跨服配置文件**：下载下面的“.hcc”类型的跨服配置文件，通过“共享”或“在其他应用中打开”调出系统分享菜单，然后选择“拷贝到‘HTTP Catcher’”；在 HTTP Catcher 中弹出的“导入”对话框中选择“好的”，即可成功导入。

  ```
  https://raw.githubusercontent.com/Mornwind/BH3CN_SwitchServer/master/HTTP_Catcher/bh3cn_switchserver_v4.0.0.hcc
  ```

2. **启用跨服配置**：进入“更多”→“重写”，在弹出的“重写列表”界面中，点击下面的跨服配置使其前面出现“✓”。
3. **启用重写功能**：在“重写列表”界面中，打开上面的“重写列表”开关；然后回到“更多”页面。
4. **启用 HTTPS 解密功能**：在“更多”页面，打开最上面的“解密 HTTPS 流量”开关（旧版本中，此开关为“开启 HTTPS 抓包”）。
5. **安装 MitM 证书**：在上一步中弹出的“安装证书描述文件”对话框中选择“安装”，允许下载配置描述文件，前往系统的“设置”→“通用”→“描述文件与设备管理”中安装 MitM 所需证书。
6. **信任 MitM 证书**：在系统的“设置”→“通用”→“关于本机”→“证书信任设置”中信任该证书；然后回到 HTTP Catcher 的“更多”页面。
7. **启用仅记录消息头**：进入“高级设置”，打开“仅记录消息头”开关；然后回到“历史”页面。
8. **启动 HTTP Catcher**：点击下方的开关按钮，然后在清除了游戏后台的情况下进入游戏，即可完成跨服。（不玩游戏时，别忘了停止 HTTP Catcher。）

</details>

### ⑵ iHTTP Tracker

<details>
<summary>点击查看：配置方法（已失效）</summary>

#### ⚠️ 特别说明 ⚠️
1. 需 iHTTP Tracker 的 2.0 (41) 及以上 TF 或商店版本。
2. 停用网络记录保存功能，可有效避免长时间使用后占用太多存储空间的问题。

#### 配置方法
1. **下载并导入跨服配置文件**：下载下面的“.cs5”类型的跨服配置文件，通过“共享”或“在其他应用中打开”调出系统分享菜单，然后分享到“iHTTP Tracker”；在 iHTTP Tracker 中弹出的“检测到导入重写规则”对话框中选择“导入”，即可成功导入。

  ```
  https://raw.githubusercontent.com/Mornwind/BH3CN_SwitchServer/master/iHTTP_Tracker/bh3cn_switchserver_v4.0.0.cs5
  ```

2. **启用跨服配置**：进入“设置”→“规则列表”，在“重写”页面中，确保刚刚导入的跨服配置的开关已打开；然后返回“设置”页面。
3. **安装 MitM 证书**：进入“设置”→“HTTPS 证书管理”，在“HTTPS 证书管理”页面中点击“前往安装证书”，在跳转的浏览器页面中点击“rootCA.pem”按钮，允许下载配置描述文件，前往系统的“设置”→“通用”→“描述文件与设备管理”中安装 MitM 所需证书。
4. **信任 MitM 证书**：在系统的“设置”→“通用”→“关于本机”→“证书信任设置”中信任该证书；然后回到 Thor 的“设置”页面。
5. **启用 HTTPS 解析**：在“设置”页面中，打开“开启 HTTPS”开关。
6. **停用网络记录保存**：在“设置”页面中，关闭“保存网络记录”开关。
7. **启动 iHTTP Tracker**：点击下方蓝色的启动按钮，然后在清除了游戏后台的情况下进入游戏，即可完成跨服。（不玩游戏时，别忘了停止 iHTTP Tracker。）

</details>

### ⑶ Thor

<details>
<summary>点击查看：配置方法（已失效）</summary>

#### ⚠️ 特别说明 ⚠️
1. 需及时清理抓包记录，避免长时间使用后占用太多存储空间。
2. 请勿从共享 Apple ID 或盗版来源下载 Thor，否则会在 Thor **验证收据时触发保护机制**，导致 Thor 的**关键功能永久失效**。
3. 请及时更新 Thor 版本，因为**新版本 Thor 上生成的跨服配置（过滤器）文件无法在旧版本上正常使用**。

#### 配置方法
1. **下载并导入跨服配置文件**：下载下面的“.f4thor”类型的跨服配置（过滤器）文件，通过“共享”或“在其他应用中打开”调出系统分享菜单，然后选择“拷贝到‘Thor’”；在弹出的跨服配置（过滤器）预览页面中，点击右上角导出图标，在弹出的菜单中选择“装载”，在弹出的“安全提醒”对话框中选择“继续”，即可成功导入；然后点击左上角的“✗”，回到首页。

```
https://raw.githubusercontent.com/Mornwind/BH3CN_SwitchServer/master/Thor/bh3cn_switchserver.f4thor
```

2. **选中跨服所用过滤器**：点击闪电按钮上方显示的过滤器名称，在弹出的“过滤器”列表中，点击刚刚导入的跨服所用过滤器，然后会自动返回首页。
3. **安装 MitM 证书**：进入“更多”→“HTTPS 解析设置”，在“HTTPS 证书管理”页面中点击“安装证书到系统”，允许下载配置描述文件，前往系统的“设置”→“通用”→“描述文件与设备管理”中安装 MitM 所需证书。
4. **信任 MitM 证书**：在系统的“设置”→“通用”→“关于本机”→“证书信任设置”中信任该证书；然后回到 Thor 的“HTTPS 证书管理”页面。
5. **启用 HTTPS 解析**：在“HTTPS 证书管理”页面中，打开证书右侧的开关；然后返回首页。
6. **启动 Thor**：点击闪电按钮启动 Thor，然后在清除了游戏后台的情况下进入游戏，即可完成跨服。（不玩游戏时，别忘了停止 Thor。）

</details>

### ⑷ Shadowrocket

<details>
<summary>点击查看：配置方法（已失效）</summary>

#### ⚠️ 特别说明 ⚠️
1. 一定要是 Shadowrocket 的 2.1.49 (964) 及以上 TF 或商店版本，因为旧版本中有一个“正则出错导致匹配结果越界”的 Bug，会使得 VPN 在触发规则时停止运行。
2. 新建的节点为本机地址（可以自行谷歌一下“localhost”及“127.0.0.1”的用途），并非自建服务器。

#### 配置方法（重定向法）
 > 默认全平台列表（本身就是完整列表，由官方云端控制，只不过账号密码登录方式中隐藏了渠道服入口）。
 > 
 > 仅使用 **URL 重定向（URL Rewrite）** 功能实现。

##### 方法一：直接订阅简易跨服配置
 > 适合于：从未使用过 Shadowrocket 的新用户；曾用过 Shadowrocket 但目前没有上外网需求的老用户；折腾不来或不爱折腾的新、老用户。

1. **新建本机节点**：在首页，点击右上角“+”，添加一个类型为“HTTP”（或“HTTPS”）、地址为“localhost”（或“127.0.0.1”）、端口为“1080”（或其他在 1-65535 之间的端口）的节点，然后在首页的“服务器节点”中选中该节点。
2. **设置路由模式**：将“全局路由”设置为“直连”。
3. **设置远程订阅 URL**：在“配置文件”页面，点击右上角“+”，输入下面的远程订阅 URL，点击下载。

  ```
  https://raw.githubusercontent.com/Mornwind/BH3CN_SwitchServer/master/Shadowrocket/bh3cn_switchserver.conf
  ```

4. **下载并应用简易跨服配置**：在“远程文件”中点击该 URL，选择“使用配置”，等待下载完毕后，即可看到“本地文件”中加载了本配置。
5. **安装 MitM 证书**：从“本地文件”中找到当前正在使用的配置，点击它，在弹出的列表中选择“编辑配置”，进入“HTTPS 解密”，点击“证书授权”部分的“密码”右侧的ⓘ，在弹出的“证书”窗口中点击“生成新的 CA 证书”，成功生成证书后，再点击“安装根证书”，允许下载配置描述文件，前往系统的“设置”→“通用”→“描述文件与设备管理”中安装该证书。
6. **信任 MitM 证书**：在系统的“设置”→“通用”→“关于本机”→“证书信任设置”中信任该证书；然后返回 Shadowrocket 的“HTTPS 解密”页面。
7. **启用 HTTPS 解密**：打开“HTTPS 解密”的开关，点击右上角的“✓”保存设置；然后返回 Shadowrocket 的首页。
8. **启动 Shadowrocket**：打开 Shadowrocket 的连接开关，然后在清除了游戏后台的情况下进入游戏，即可实现跨服。（不玩游戏时，别忘了停止 Shadowrocket 的连接。）

##### 方法二：手动写入当前使用中配置
 > 适合于：目前仍在使用 Shadowrocket 上外网的老用户；爱折腾的新、老用户。

1. **进入配置编辑界面**：在“配置文件”页面，从“本地文件”中找到当前正在使用的配置，点击它，在弹出的列表中选择“编辑纯文本”。
2. **添加跨服配置**：在弹出的编辑窗口中，将以下配置中 `[URL Rewrite]`、`[MITM]` 两处下方的代码，在配置文件中分别找到对应位置复制进去，然后点击右上角的“保存”。

  ```
  [URL Rewrite]
  # 崩坏3 跨服
  # > 获取全平台服务器列表
  ^https:\/\/(.+?)\.bh3\.com\/query_dispatch\?version=(.+?)_gf_(.+?)&t=(\d+) https://$1.bh3.com/query_dispatch?version=$2_gf_pc&t=$4 HEADER
  # > 改写连入服务器的客户端标识
  # >> 安卓国服
  ^http:\/\/106\.14\.51\.73\/query_gameserver\?version=(.+?)_gf_(.+?)&t=(\d+)&uid=(\d+) http://106.14.51.73/query_gameserver?version=$1_gf_pc&t=$3&uid=$4 HEADER
  # >> iOS国服
  ^http:\/\/139\.224\.7\.27\/query_gameserver\?version=(.+?)_gf_(.+?)&t=(\d+)&uid=(\d+) http://139.224.7.27/query_gameserver?version=$1_gf_pc&t=$3&uid=$4 HEADER
  # >> 全平台（桌面）服
  ^http:\/\/106\.15\.162\.73\/query_gameserver\?version=(.+?)_gf_(.+?)&t=(\d+)&uid=(\d+) http://106.15.162.73/query_gameserver?version=$1_gf_pc&t=$3&uid=$4 HEADER
  
  [MITM]
  hostname = *.bh3.com
  ```

3. **安装 MitM 证书**：从“本地文件”中找到当前正在使用的配置，点击它，在弹出的列表中选择“编辑配置”，进入“HTTPS 解密”，点击“证书授权”部分的“密码”右侧的ⓘ，在弹出的“证书”窗口中点击“生成新的 CA 证书”，成功生成证书后，再点击“安装根证书”，允许下载配置描述文件，前往系统的“设置”→“通用”→“描述文件与设备管理”中安装该证书。
4. **信任 MitM 证书**：在系统的“设置”→“通用”→“关于本机”→“证书信任设置”中信任该证书；然后返回 Shadowrocket 的“HTTPS 解密”页面。
5. **启用 HTTPS 解密**：打开“HTTPS 解密”的开关，点击右上角的“✓”保存设置；然后返回 Shadowrocket 的首页。
6. **重启 Shadowrocket**：为确保修改生效，可以开关一次 Shadowrocket 的连接开关，然后在清除了游戏后台的情况下进入游戏，即可实现跨服。

</details>

### ⑸ Pepi

<details>
<summary>点击查看：配置方法（已失效）</summary>

#### ⚠️ 特别说明 ⚠️
1. 新建的节点为本机地址（可以自行谷歌一下“localhost”及“127.0.0.1”的用途），并非自建服务器。

#### 配置方法（重定向法）
 > 默认全平台列表（本身就是完整列表，由官方云端控制，只不过账号密码登录方式中隐藏了渠道服入口）。
 > 
 > 仅使用 **URL 重定向（URL Rewrite）** 功能实现。

##### 方法一：直接下载简易跨服配置
 > 适合于：从未使用过 Pepi 的新用户；曾用过 Pepi 但目前没有上外网需求的老用户；折腾不来或不爱折腾的新、老用户。

1. **新建本机节点**：在首页，点击绿色圆按钮下方第一个项目“暂无节点”，进入“服务器节点”页面，点击“添加节点”，然后添加一个类型为“HTTP”（或“HTTPS”）、地址为“localhost”（或“127.0.0.1”）、端口为“1080”（或其它在 1-65535 之间的端口）的节点，然后在“服务器节点”页面。
2. **下载并应用简易跨服规则文件**：点击主页左上角三横线“☰”，进入“配置”→“规则文件”页面，点击“导入”中的“从 URL 下载”，在弹出的窗口中，输入下面的 URL 下载规则文件，然后在上方“规则文件”列表中点击选中刚刚下载的规则。

  ```
  https://raw.githubusercontent.com/Mornwind/BH3CN_SwitchServer/master/Pepi/bh3cn_switchserver.conf
  ```

3. **安装 MitM 证书**：回到首页，点击主页左上角三横线“☰”，进入“设置”→“HTTPS”页面，点击“证书”中的“生成新的 CA 证书”，成功生成证书后，再点击“安装根证书”，允许下载配置描述文件，前往系统的“设置”→“通用”→“描述文件与设备管理”中安装该证书。
4. **信任 MitM 证书**：在系统的“设置”→“通用”→“关于本机”→“证书信任设置”中信任该证书；然后回到 Pepi 的“HTTPS”页面。
5. **配置 HTTPS 解密**：在“HTTPS”页面中，进入“域名”页面，在“添加主机名称”中添加一条 `*.bh3.com`，然后点击右上角“✓”，回到“HTTPS”页面，打开“解密 HTTPS 流量”开关，然后再点击右上角“✓”，然后回到首页。
6. **启动 Pepi**：在首页，点击中间绿色圆形按钮启动 Pepi，然后在清除了游戏后台的情况下进入游戏，即可实现跨服。（不玩游戏时，别忘了停止 Pepi。）

##### 方法二：手动写入当前使用中配置
 > 适合于：目前仍在使用 Pepi 上外网的老用户；爱折腾的新、老用户。

1. **新建本机节点**：在首页，点击绿色圆按钮下方第一个项目“暂无节点”，进入“服务器节点”页面，点击“添加节点”，然后添加一个类型为“HTTP”（或“HTTPS”）、地址为“localhost”（或“127.0.0.1”）、端口为“1080”（或其它在 1-65535 之间的端口）的节点，然后在“服务器节点”页面。
2. **进入配置编辑界面**：点击主页左上角三横线“☰”，进入“配置”→“规则文件”页面，在“规则文件”中找到正在使用的规则文件，左划，点击“编辑”，进入配置编辑界面。
3. **添加跨服配置**：在弹出的编辑窗口中，将以下配置中 `[URL REWRITE]` 下方的代码，在配置文件中找到对应位置复制进去，然后点击右上角的“保存”。

  ```
  [URL REWRITE]
  # 崩坏3 跨服
  # > 获取全平台服务器列表
  ^https:\/\/(.+?)\.bh3\.com\/query_dispatch\?version=(.+?)_gf_(.+?)&t=(\d+) https://$1.bh3.com/query_dispatch?version=$2_gf_pc HEADER
  # > 改写连入服务器的客户端标识
  # >> 安卓国服
  ^http:\/\/106\.14\.51\.73\/query_gameserver\?version=(.+?)_gf_(.+?)&t=(\d+)&uid=(\d+) http://106.14.51.73/query_gameserver?version=$1_gf_pc HEADER
  # >> iOS国服
  ^http:\/\/139\.224\.7\.27\/query_gameserver\?version=(.+?)_gf_(.+?)&t=(\d+)&uid=(\d+) http://139.224.7.27/query_gameserver?version=$1_gf_pc HEADER
  # >> 全平台（桌面）服
  ^http:\/\/106\.15\.162\.73\/query_gameserver\?version=(.+?)_gf_(.+?)&t=(\d+)&uid=(\d+) http://106.15.162.73/query_gameserver?version=$1_gf_pc HEADER
  ```

4. **安装 MitM 证书**：回到首页，点击主页左上角三横线“☰”，进入“设置”→“HTTPS”页面，点击“证书”中的“生成新的 CA 证书”，成功生成证书后，再点击“安装根证书”，允许下载配置描述文件，前往系统的“设置”→“通用”→“描述文件与设备管理”中安装该证书。
5. **信任 MitM 证书**：在系统的“设置”→“通用”→“关于本机”→“证书信任设置”中信任该证书，然后回到 Pepi 的“HTTPS”页面。
6. **配置 HTTPS 解密**：在“HTTPS”页面中，进入“域名”页面，在“添加主机名称”中添加一条 `*.bh3.com`，然后点击右上角“✓”，回到“HTTPS”页面，打开“解密 HTTPS 流量”开关，然后再点击右上角“✓”，然后回到首页。
7. **重启 Pepi**：在首页，点击中间绿色圆形按钮启动 Pepi，然后在清除了游戏后台的情况下进入游戏，即可实现跨服。

</details>

### ⑹ Quantumult

<details>
<summary>点击查看：配置方法（已失效）</summary>

#### ⚠️ 特别说明 ⚠️
1. 运行模式请一定要选择为“自动分流”模式，否则会导致跨服配置不生效。

#### 配置方法（重定向法）
 > 默认全平台列表（本身就是完整列表，由官方云端控制，只不过账号密码登录方式中隐藏了渠道服入口）。
 > 
 > 仅使用 **URL 重定向（URL Rewrite）** 功能实现。

##### 方法一：直接下载简易跨服配置
 > 适合于：从未使用过 Quantumult 的新用户；曾用过 Quantumult 但目前没有上外网需求的老用户；折腾不来或不爱折腾的新、老用户。

1. **下载简易跨服配置**：在“设置”页面的“配置文件”部分，点击“下载配置文件”，在弹出的窗口中输入下面的配置文件下载 URL，点击“好”来下载配置文件，然后在弹出的配置编辑窗口中点击右上角“保存”。

  ```
  https://raw.githubusercontent.com/Mornwind/BH3CN_SwitchServer/master/Quantumult/bh3cn_switchserver.conf
  ```

2. **启用 HTTPS 解密**：在“设置”页面的“TCP”部分，找到“HTTPS 解密”点击进入，然后打开“HTTPS 解密”的开关。
3. **安装 MitM 证书**：点击下方“密钥及证书”部分中的“生成密钥及证书”，成功生成证书后，点击右上角“保存”，允许下载配置描述文件，前往系统的“设置”→“通用”→“描述文件与设备管理”中安装该证书。
4. **信任 MitM 证书**：在系统的“设置”→“通用”→“关于本机”→“证书信任设置”中信任该证书；返回 Quantumult，保存“HTTPS 解密”设置，然后返回“设置”页面。
5. **设置运行模式**：在“设置”页面的“TCP”部分，找到“运行模式”点击进入，在“选择运行模式”中选择“自动分流”，然后返回“主页”。
6. **启动 Quantumult**：打开“主页”右上角的连接开关，然后在清除了游戏后台的情况下进入游戏，即可实现跨服。
7. **停止 Quantumult**：不玩游戏时，别忘了停止 Quantumult 的连接。

##### 方法二：手动写入当前使用中配置
 > 适合于：目前仍在使用 Quantumult 上外网的老用户；爱折腾的新、老用户。

1. **进入配置编辑界面**：在“设置”页面的“配置文件”部分，点击“编辑配置文件”。
2. **添加跨服配置**：在弹出的编辑窗口中，将以下配置中 `[REWRITE]`、`[MITM]` 两处下方的代码，在配置文件中分别找到对应位置复制进去，然后点击右上角的“保存”。

  ```
  [REWRITE]
  # 崩坏3 跨服
  # > 获取全平台服务器列表
  ^https:\/\/(.+?)\.bh3\.com\/query_dispatch\?version=(.+?)_gf_(.+?)&t=(\d+) url 302 https://$1.bh3.com/query_dispatch?version=$2_gf_pc&t=$4
  # > 改写连入服务器的客户端标识
  # >> 安卓国服
  ^http:\/\/106\.14\.51\.73\/query_gameserver\?version=(.+?)_gf_(.+?)&t=(\d+)&uid=(\d+) url 302 http://106.14.51.73/query_gameserver?version=$1_gf_pc&t=$3&uid=$4
  # >> iOS国服
  ^http:\/\/139\.224\.7\.27\/query_gameserver\?version=(.+?)_gf_(.+?)&t=(\d+)&uid=(\d+) url 302 http://139.224.7.27/query_gameserver?version=$1_gf_pc&t=$3&uid=$4
  # >> 全平台（桌面）服
  ^http:\/\/106\.15\.162\.73\/query_gameserver\?version=(.+?)_gf_(.+?)&t=(\d+)&uid=(\d+) url 302 http://106.15.162.73/query_gameserver?version=$1_gf_pc&t=$3&uid=$4
  
  [MITM]
  hostname = *.bh3.com
  ```

3. **启用 HTTPS 解密**：在“设置”页面的“TCP”部分，找到“HTTPS 解密”点击进入，然后打开“HTTPS 解密”的开关。
4. **安装 MitM 证书**：点击下方“密钥及证书”部分中的“生成密钥及证书”，成功生成证书后，点击右上角“保存”，允许下载配置描述文件，前往系统的“设置”→“通用”→“描述文件与设备管理”中安装该证书。
5. **信任 MitM 证书**：在系统的“设置”→“通用”→“关于本机”→“证书信任设置”中信任该证书；返回 Quantumult，保存“HTTPS 解密”设置，然后返回“设置”页面。
6. **设置运行模式**：在“设置”页面的“TCP”部分，找到“运行模式”点击进入，在“选择运行模式”中选择“自动分流”，然后返回“主页”。
7. **重启 Quantumult**：为确保修改生效，可以开关一次 Quantumult 的连接开关，然后在清除了游戏后台的情况下进入游戏，即可实现跨服。

</details>

### ⑺ Quantumult X

<details>
<summary>点击查看：配置方法（已失效）</summary>

#### ⚠️ 特别说明 ⚠️
1. “脚本法”中，跨服脚本中**并未含有**用于修改游戏内数据以获得不正当收益的作弊内容，只是用来切换服务器，故理论上不会被封号。跨服脚本代码**公开透明**地存放于本项目中，欢迎随时进行检查。如若不放心，还请使用“重定向法”，或者另寻他法。
2. 请勿从共享 Apple ID 或盗版来源下载 Quantumult X，否则会在 Quantumult X **验证收据时触发保护机制**，导致 Quantumult X 的**关键功能永久失效**。

#### 配置教程
详见 FlintyLemming 的 [Quantumult X 跨服教程](https://bitbucket.flinty.moe/projects/PER/repos/bh3_server_switch/browse/README.md)。

#### 配置方法
##### 方法 A：重定向法
 > 默认全平台列表（本身就是完整列表，由官方云端控制，只不过账号密码登录方式中隐藏了渠道服入口）。
 > 
 > 仅使用 **URL 重定向（URL Rewrite）** 功能实现。

  ```
  [rewrite_remote]
  # 崩坏3 跨服（新手直接订阅使用，无需自行更动）
  https://raw.githubusercontent.com/Mornwind/BH3CN_SwitchServer/master/Quantumult_X/bh3cn_switchserver.conf, tag=BH3CN_SwitchServer, enabled=true
  ```

##### 方法 B：脚本法
 > 默认全平台列表（本身就是完整列表，由官方云端控制，只不过账号密码登录方式中隐藏了渠道服入口）。
 > 
 > 仅使用 **脚本（Script）** 功能实现。

###### 本地脚本（商店版、TF 版均可用）
  ```
  [rewrite_local]
  # 崩坏3 跨服
  # > 获取全平台服务器列表
  ^https:\/\/(.+?)\.bh3\.com\/query_dispatch\?version=(.+?)_gf_(.+?)&t=(\d+) url script-request-header bh3cn_switchserver.js
  # > 改写连入服务器的客户端标识
  ^http:\/\/(.+?)\/query_gameserver\?version=(.+?)_gf_(.+?)&t=(\d+)&uid=(\d+) url script-request-header bh3cn_switchserver.js
  
  [MITM]
  hostname = *.bh3.com
  ```

###### 远程脚本（仅 TF 版可用）
  ```
  [rewrite_local]
  # 崩坏3 跨服
  # > 获取全平台服务器列表
  ^https:\/\/(.+?)\.bh3\.com\/query_dispatch\?version=(.+?)_gf_(.+?)&t=(\d+) url script-request-header https://raw.githubusercontent.com/Mornwind/BH3CN_SwitchServer/master/Quantumult_X/bh3cn_switchserver.js
  # > 改写连入服务器的客户端标识
  ^http:\/\/(.+?)\/query_gameserver\?version=(.+?)_gf_(.+?)&t=(\d+)&uid=(\d+) url script-request-header https://raw.githubusercontent.com/Mornwind/BH3CN_SwitchServer/master/Quantumult_X/bh3cn_switchserver.js
  
  [MITM]
  hostname = *.bh3.com
  ```

</details>

### ⑻ Surge 4

<details>
<summary>点击查看：配置方法（已失效）</summary>

#### ⚠️ 特别说明 ⚠️
1. “脚本法”中，跨服脚本中**并未含有**用于修改游戏内数据以获得不正当收益的作弊内容，只是用来切换服务器，故理论上不会被封号。跨服脚本代码**公开透明**地存放于本项目中，欢迎随时进行检查。如若不放心，还请使用“重定向法”，或者另寻他法。

#### 跨服方法
##### 方法 A：重定向法
 > 默认全平台列表（本身就是完整列表，由官方云端控制，只不过账号密码登录方式中隐藏了渠道服入口）。
 > 
 > 基于 **URL 重定向（URL Rewrite）** 功能实现跨服，并可通过 **模块（Module）** 功能实现配置订阅。

###### 操作方法一：添加模块化跨服配置，无需手动编辑（推荐）
1. **安装 MitM 证书**：在“首页”中找到“MitM”卡片（若未找到，则去“更多”→“外观”→“卡片”中将该卡片设为可见），点击“配置根证书”，在弹出的“HTTPS 解密”窗口中，点击“生成新的 CA 证书”，成功生成证书后，再点击“安装根证书”，允许下载配置描述文件，前往系统的“设置”→“通用”→“描述文件与设备管理”中安装 MitM 所需证书。
2. **信任 MitM 证书**：在系统的“设置”→“通用”→“关于本机”→“证书信任设置”中信任该证书；然后回到 Surge 4 的“首页”。
3. **安装并启用跨服配置模块**：在“首页”中找到“模块”卡片（若未找到，则去“更多”→“外观”→“卡片”中将该卡片设为可见），点击“模块”，在弹出的“模块”界面中，找到“安装的模块”部分，点击“安装新模块...”，然后在弹出的“安装模块”对话框中输入下面的 URL 地址，点“好的”下载模块文件。然后在弹出的配置预览窗口中，**检查有无恶意内容并仔细阅读最下方的“警告”**，在确认无误后，点击最下方的“安装”。回到“模块”界面，即可看到跨服配置模块已成功安装，左侧有“✓”表示该模块已启用。

  ```
  https://raw.githubusercontent.com/Mornwind/BH3CN_SwitchServer/master/Surge_4/bh3cn_switchserver_A.sgmodule
  ```

4. **启用“Rewrite”和“MitM”功能**：回到“首页”中，将“Rewrite”和“MitM”两个卡片的开关打开（若未找到，则去“更多”→“外观”→“卡片”中将该卡片设为可见）。
5. **启用“始终开启”功能**：在“更多”→“设置”→“始终开启”中，打开“自动启动 Surge”的开关，即可保持 Surge 4 一直后台开启。
6. **启动 Surge 4**：点击“首页”右上角“启动”按钮启动 Surge 4，即可在 iOS 端跨服登录安卓国服。

###### 操作方法二：手动将跨服配置写入配置文件
1. **安装 MitM 证书**：在“首页”中找到“MitM”卡片（若未找到，则去“更多”→“外观”→“卡片”中将该卡片设为可见），点击“配置根证书”，在弹出的“HTTPS 解密”窗口中，点击“生成新的 CA 证书”，成功生成证书后，再点击“安装根证书”，允许下载配置描述文件，前往系统的“设置”→“通用”→“描述文件与设备管理”中安装 MitM 所需证书。
2. **信任 MitM 证书**：在系统的“设置”→“通用”→“关于本机”→“证书信任设置”中信任该证书；然后回到 Surge 4 的“首页”。
3. **手动添加跨服配置**：点击“首页”左上角配置名，在弹出的“配置列表”窗口中，点击“在文本模式中编辑”（或是使用任一款编辑器打开你的 Surge 配置文件（.conf）直接进行编辑）。在编辑窗口中，将以下配置中 `[URL Rewrite]`、`[MITM]` 两处下方的代码，在配置文件中分别找到对应位置复制进去，然后点击右上角“完成”保存修改。

  ```
  [URL Rewrite]
  # 崩坏3 跨服
  # > 获取全平台服务器列表
  ^https:\/\/(.+?)\.bh3\.com\/query_dispatch\?version=(.+?)_gf_(.+?)&t=(\d+) https://$1.bh3.com/query_dispatch?version=$2_gf_pc&t=$4 header
  # > 改写连入服务器的客户端标识
  # >> 安卓国服
  ^http:\/\/106\.14\.51\.73\/query_gameserver\?version=(.+?)_gf_(.+?)&t=(\d+)&uid=(\d+) http://106.14.51.73/query_gameserver?version=$1_gf_pc&t=$3&uid=$4 header
  # >> iOS国服
  ^http:\/\/139\.224\.7\.27\/query_gameserver\?version=(.+?)_gf_(.+?)&t=(\d+)&uid=(\d+) http://139.224.7.27/query_gameserver?version=$1_gf_pc&t=$3&uid=$4 header
  # >> 全平台（桌面）服
  ^http:\/\/106\.15\.162\.73\/query_gameserver\?version=(.+?)_gf_(.+?)&t=(\d+)&uid=(\d+) http://106.15.162.73/query_gameserver?version=$1_gf_pc&t=$3&uid=$4 header
  
  [MITM]
  hostname = *.bh3.com
  ```

4. **启用“Rewrite”和“MitM”功能**：回到“首页”中，将“Rewrite”和“MitM”两个卡片的开关打开（若未找到，则去“更多”→“外观”→“卡片”中将该卡片设为可见）。
5. **启用“始终开启”功能**：在“更多”→“设置”→“始终开启”中，打开“自动启动 Surge”的开关，即可保持 Surge 4 一直后台开启。
6. **启动 Surge 4**：点击“首页”右上角“启动”按钮启动 Surge 4，即可在 iOS 端跨服登录安卓国服。

##### 方法 B：脚本法
 > 默认全平台列表（本身就是完整列表，由官方云端控制，只不过账号密码登录方式中隐藏了渠道服入口）。
 > 
 > 基于 **脚本（Script）** 功能实现跨服，并可通过 **模块（Module）** 功能实现配置订阅。

###### 操作方法一：添加模块化跨服配置，无需手动编辑（推荐）
1. **安装 MitM 证书**：在“首页”中找到“MitM”卡片（若未找到，则去“更多”→“外观”→“卡片”中将该卡片设为可见），点击“配置根证书”，在弹出的“HTTPS 解密”窗口中，点击“生成新的 CA 证书”，成功生成证书后，再点击“安装根证书”，允许下载配置描述文件，前往系统的“设置”→“通用”→“描述文件与设备管理”中安装 MitM 所需证书。
2. **信任 MitM 证书**：在系统的“设置”→“通用”→“关于本机”→“证书信任设置”中信任该证书；然后回到 Surge 4 的“首页”。
3. **安装并启用跨服配置模块**：在“首页”中找到“模块”卡片（若未找到，则去“更多”→“外观”→“卡片”中将该卡片设为可见），点击“模块”，在弹出的“模块”界面中，找到“安装的模块”部分，点击“安装新模块...”，然后在弹出的“安装模块”对话框中输入下面的 URL 地址，点“好的”下载模块文件。然后在弹出的配置预览窗口中，**检查有无恶意内容并仔细阅读最下方的“警告”**，在确认无误后，点击最下方的“安装”。回到“模块”界面，即可看到跨服配置模块已成功安装，左侧有“✓”表示该模块已启用。

  ```
  https://raw.githubusercontent.com/Mornwind/BH3CN_SwitchServer/master/Surge_4/bh3cn_switchserver_B.sgmodule
  ```

4. **启用“脚本”和“MitM”功能**：回到“首页”中，将“脚本”和“MitM”两个卡片的开关打开（若未找到，则去“更多”→“外观”→“卡片”中将该卡片设为可见）。
5. **启用“始终开启”功能**：在“更多”→“设置”→“始终开启”中，打开“自动启动 Surge”的开关，即可保持 Surge 4 一直后台开启。
6. **启动 Surge 4**：点击“首页”右上角“启动”按钮启动 Surge 4，即可在 iOS 端跨服登录安卓国服。

###### 操作方法二：手动将跨服配置写入配置文件
1. **安装MitM 证书**：在“首页”中找到“MitM”卡片（若未找到，则去“更多”→“外观”→“卡片”中将该卡片设为可见），点击“配置根证书”，在弹出的“HTTPS 解密”窗口中，点击“生成新的 CA 证书”，成功生成证书后，再点击“安装根证书”，允许下载配置描述文件，前往系统的“设置”→“通用”→“描述文件与设备管理”中安装 MitM 所需证书。
2. **信任 MitM 证书**：在系统的“设置”→“通用”→“关于本机”→“证书信任设置”中信任该证书；然后回到 Surge 4 的“首页”。
3. **手动添加跨服配置**：点击“首页”左上角配置名，在弹出的“配置列表”窗口中，点击“在文本模式中编辑”（或是使用任一款编辑器打开你的 Surge 配置文件（.conf）直接进行编辑）。在编辑窗口中，将以下配置中 `[Script]`、`[MITM]` 两处下方的代码，在配置文件中分别找到对应位置复制进去，然后点击右上角“完成”保存修改。

  ```
  [Script]
  # 崩坏3 跨服
  # > 获取全平台服务器列表
  bh3cn_switchserver = type=http-request,pattern=^https:\/\/(.+?)\.bh3\.com\/query_dispatch\?version=(.+?)_gf_(.+?)&t=(\d+),script-path=https://raw.githubusercontent.com/Mornwind/BH3CN_SwitchServer/master/Surge_4/bh3cn_switchserver.js
  # > 改写连入服务器的客户端标识
  bh3cn_switchserver = type=http-request,pattern=^http:\/\/(.+?)\/query_gameserver\?version=(.+?)_gf_(.+?)&t=(\d+)&uid=(\d+),script-path=https://raw.githubusercontent.com/Mornwind/BH3CN_SwitchServer/master/Surge_4/bh3cn_switchserver.js
  
  [MITM]
  hostname = *.bh3.com
  ```

4. **启用“脚本”和“MitM”功能**：回到“首页”中，将“脚本”和“MitM”两个卡片的开关打开（若未找到，则去“更多”→“外观”→“卡片”中将该卡片设为可见）。
5. **启用“始终开启”功能**：在“更多”→“设置”→“始终开启”中，打开“自动启动 Surge”的开关，即可保持 Surge 4 一直后台开启。
6. **启动 Surge 4**：点击“首页”右上角“启动”按钮启动 Surge 4，即可完成跨服。

</details>

### ⑼ Loon
 > 参考方法 [⑻ Surge 4](#-surge-4)，此处略去。

## A-2 类型（未提供）
 > A-2：通过**使用他人提供的代理服务器**，**在远端重写客户端请求**，**直接**实现跨服。

尚不提供此方式为「崩坏3」进行跨服。

## B 类型（已全部失效）
 > B-1：通过**对游戏客户端修改后重新打包**，**由他人统一签名后在线下载安装**，**直接**实现跨服。
 > 
 > B-2：通过**对游戏客户端修改后重新打包**，**自行签名然后越狱安装或侧载**，**直接**实现跨服。

| 图标 | 跨服工具 | 别名 | 跨服教程与配置 |
| :-: | :-: | :-: | :-: |
| - | ME 社跨服包 | - | 见 ME 社公众号 |
| - | 逆熵乐队跨服包 | - | 见逆熵乐队公众号 |

| 跨服工具 | 国区商店<br/>购买与下载 | 正规渠道价格 | 跨服操作<br/>方便程度 | 设备上同时<br/>挂梯与跨服 | 备注 |
| :-: | :-: | :-: | :-: | :-: | :-: |
| ME 社跨服包<br/>（自签） | - | 免费 | ★ | ✅ | Cydia 已失效 |
| ME 社跨服包<br/>（免签） | - | ¥60.00/三个大版本 | ★★★★★ | ✅ |  |
| 逆熵乐队跨服包<br/>（自签） | - | 免费 | ★ | ✅ | 已停止更新 |

 > 注：
 > 
 > ME 社 - 微信公众号：（主）`me_shebao`；（备）`me_dby`
 > 
 > AntiEntropy 逆熵乐队 - 微信公众号：`aeband`

## C-1 类型
 > C-1：通过**使用云游戏平台**，**将游戏画面实时传输至移动设备**，**间接**实现跨服。

| 图标 | 跨服工具 | 别名 | 跨服教程与配置 |
| :-: | :-: | :-: | :-: |
| - | 网易云游戏 | - | 见网易云游戏官网 |

| 跨服工具 | 国区商店<br/>购买与下载 | 正规渠道价格 | 跨服操作<br/>方便程度 | 设备上同时<br/>挂梯与跨服 | 备注 |
| :-: | :-: | :-: | :-: | :-: | :-: |
| 网易云游戏 | - | ¥15.9/月<br/>¥70/季<br/>¥240/年 | ★★★★★ | ✅ | 部分渠道服平台未提供 |

 > 注：
 > 
 > 网易云游戏 - 官网：<https://cg.163.com>

## C-2 类型
 > C-2：通过**使用云主机**，**将游戏画面实时传输至移动设备**，**间接**实现跨服。

此方法需自行摸索。

---

## 附录1：App Store 链接
- **游戏本体**
  - 崩坏3：<https://apps.apple.com/app/id1143402987>

- **网络调试工具（仅抓包）**
  - HTTP Catcher：<https://apps.apple.com/app/id1445874902>
  - iHTTP Tracker：<https://apps.apple.com/app/id1463315864>
  - Thor：<https://apps.apple.com/app/id1210562295>
- **网络调试工具（抓包、代理）**
  - Shadowrocket：<https://apps.apple.com/app/id932747118>
  - Pepi：<https://apps.apple.com/app/id1283082051>
  - Quantumult：<https://apps.apple.com/app/id1252015438>
  - Quantumult X：<https://apps.apple.com/app/id1443988620>
  - Surge 4：<https://apps.apple.com/app/id1442620678>
  - Loon：<https://apps.apple.com/app/id1373567447>

## 附录2：「崩坏3」国服客户端标识
 > 以下为分别连接不同的国服服务器时，有效的客户端标识。

- **官服**
  - 安卓国服：`gf_android`，`gf_pc`
  - iOS 国服：`gf_ios`，`gf_pc`
  - 全平台（桌面）服：`gf_pc`，`gf_android`，`gf_ios`
- **渠道服**
  - Bilibili 服：`gf_pc`，`gf_android_bilibili`
  - 应用宝服：`gf_pc`，`gf_android_tencent`
  - 渠道 1 服：`gf_pc`，`gf_android_coolpad`，`gf_android_gionee`，`gf_android_huawei`，`gf_android_lenovo`，`gf_android_oppo`，`gf_android_vivo`
  - 渠道 2 服：`gf_pc`，`gf_android_qihoo`，`gf_android_uc`，`gf_android_wandoujia`，`gf_android_xiaomi`
- **测试服**（需搭配测试专用客户端）
  - 安卓测试服：`beta`
  - iOS 测试服：`beta_ios`

## 附录3：「崩坏3」国服服务器的配置信息所在服务器 IP
 > 以下为获取各个国服服务器配置信息时，所访问的服务器 IP。

- **官服**
  - 安卓国服：`106.14.51.73`
  - iOS 国服：`139.224.7.27`
  - 全平台（桌面）服：`106.15.162.73`
- **渠道服**
  - Bilibili 服：`139.196.248.220`
  - 应用宝服：`115.159.20.29`
  - 渠道 1 服：`139.196.248.218`
  - 渠道 2 服：`139.196.248.219`
- **测试服**（需搭配测试专用客户端）
  - 安卓测试服（外部）：`139.196.1.196:5080`
  - iOS 测试服（外部）：`49.235.123.106:16000`

## 附录4：「崩坏3」服务器状态标识
- **推荐**：`"retcode": 0`、`"server_state": "Recommend"`
- **隐藏**：`"retcode": 0`、`"server_state": "HIDE"`
- **维护**：`"retcode": 2`
